性能问题

这个应用的home页面关键渲染路径过长，有三个存在数据依赖的请求（还只是数据请求，而且地理位置需要用户许可权限才可以拿）。浏览器获取html请求js，然后js先利用浏览器api获取客户端经纬度坐标，然后向服务端发送该信息获取城市id，客户端子组件获取id后再发送请求天气数据。
对比之下，search和home几乎需要一样的数据量来渲染页面，search明显快很多。严格来说，search多一个热门城市请求，但有流式渲染这是并行发起的，实际没有影响。


改进

用中间件把默认页面改成search页面，search页面来请求用户权限，拿到位置存进sessionStorage，切换到home时，直接从存储拿位置，在这种情况下可以省去第一个请求。
后续请求的另一个方案是使用page.js统一请求所有天气数据，向服务器发送地理位置，服务器请求城市id，然后继续请求天气信息，然后一并返回它们。这样做因为数据是一起返回的，所以整体会受到最慢数据的影响，而且单次返回的数据规模比较大。
或者利用地理位置向服务器发送多个请求，服务器请求id并缓存，再拿天气数据。
不过，所有数据都由page获取，且由state存的话，存在交互的某个数据再更改state时，会引起整个page组件重渲染。


复用组件

关于复用，服务端与客户端的主要区别在于数据抓取方式不同。如果各个子组件是使用要渲染的数据而不是id作为参数的话，这些子组件基本都是可以直接复用的。给它们加专门抓取数据的中间层，或像优化里那样统一在page组件抓取可以做到这一点。