import {doFetchBack, handleErrBack, moveSearchParams, useStoredData} from "@/app/api/lib/url-manipulator";

const baseUrl = "https://devapi.qweather.com/v7/weather/24h"
const cached = [
  {
    "fxTime": "2024-05-03T22:00+08:00",
    "temp": "19",
    "icon": "151",
    "text": "Cloudy",
    "wind360": "132",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "79",
    "pop": "14",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "87",
    "dew": "15"
  },
  {
    "fxTime": "2024-05-03T23:00+08:00",
    "temp": "18",
    "icon": "151",
    "text": "Cloudy",
    "wind360": "139",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "83",
    "pop": "14",
    "precip": "0.0",
    "pressure": "821",
    "cloud": "95",
    "dew": "15"
  },
  {
    "fxTime": "2024-05-04T00:00+08:00",
    "temp": "16",
    "icon": "151",
    "text": "Cloudy",
    "wind360": "143",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "88",
    "pop": "9",
    "precip": "0.0",
    "pressure": "821",
    "cloud": "88",
    "dew": "14"
  },
  {
    "fxTime": "2024-05-04T01:00+08:00",
    "temp": "15",
    "icon": "151",
    "text": "Cloudy",
    "wind360": "150",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "91",
    "pop": "0",
    "precip": "0.0",
    "pressure": "821",
    "cloud": "80",
    "dew": "14"
  },
  {
    "fxTime": "2024-05-04T02:00+08:00",
    "temp": "14",
    "icon": "153",
    "text": "Partly Cloudy",
    "wind360": "156",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "94",
    "pop": "0",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "72",
    "dew": "13"
  },
  {
    "fxTime": "2024-05-04T03:00+08:00",
    "temp": "14",
    "icon": "153",
    "text": "Partly Cloudy",
    "wind360": "150",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "95",
    "pop": "0",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "74",
    "dew": "13"
  },
  {
    "fxTime": "2024-05-04T04:00+08:00",
    "temp": "13",
    "icon": "151",
    "text": "Cloudy",
    "wind360": "141",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "100",
    "pop": "1",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "76",
    "dew": "13"
  },
  {
    "fxTime": "2024-05-04T05:00+08:00",
    "temp": "13",
    "icon": "151",
    "text": "Cloudy",
    "wind360": "137",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "95",
    "pop": "1",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "78",
    "dew": "13"
  },
  {
    "fxTime": "2024-05-04T06:00+08:00",
    "temp": "15",
    "icon": "103",
    "text": "Partly Cloudy",
    "wind360": "143",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "88",
    "pop": "4",
    "precip": "0.0",
    "pressure": "819",
    "cloud": "58",
    "dew": "13"
  },
  {
    "fxTime": "2024-05-04T07:00+08:00",
    "temp": "18",
    "icon": "102",
    "text": "Few Clouds",
    "wind360": "181",
    "windDir": "S",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "76",
    "pop": "9",
    "precip": "0.0",
    "pressure": "819",
    "cloud": "37",
    "dew": "14"
  },
  {
    "fxTime": "2024-05-04T08:00+08:00",
    "temp": "21",
    "icon": "100",
    "text": "Sunny",
    "wind360": "261",
    "windDir": "W",
    "windScale": "1-3",
    "windSpeed": "4",
    "humidity": "69",
    "pop": "9",
    "precip": "0.0",
    "pressure": "819",
    "cloud": "17",
    "dew": "15"
  },
  {
    "fxTime": "2024-05-04T09:00+08:00",
    "temp": "22",
    "icon": "102",
    "text": "Few Clouds",
    "wind360": "285",
    "windDir": "W",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "64",
    "pop": "13",
    "precip": "0.0",
    "pressure": "819",
    "cloud": "38",
    "dew": "15"
  },
  {
    "fxTime": "2024-05-04T10:00+08:00",
    "temp": "24",
    "icon": "103",
    "text": "Partly Cloudy",
    "wind360": "294",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "9",
    "humidity": "59",
    "pop": "44",
    "precip": "0.0",
    "pressure": "819",
    "cloud": "59",
    "dew": "16"
  },
  {
    "fxTime": "2024-05-04T11:00+08:00",
    "temp": "26",
    "icon": "302",
    "text": "Thundershower",
    "wind360": "300",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "9",
    "humidity": "54",
    "pop": "44",
    "precip": "0.1",
    "pressure": "820",
    "cloud": "80",
    "dew": "16"
  },
  {
    "fxTime": "2024-05-04T12:00+08:00",
    "temp": "24",
    "icon": "302",
    "text": "Thundershower",
    "wind360": "305",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "9",
    "humidity": "63",
    "pop": "51",
    "precip": "0.9",
    "pressure": "820",
    "cloud": "67",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T13:00+08:00",
    "temp": "23",
    "icon": "103",
    "text": "Partly Cloudy",
    "wind360": "306",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "9",
    "humidity": "70",
    "pop": "38",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "53",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T14:00+08:00",
    "temp": "21",
    "icon": "102",
    "text": "Few Clouds",
    "wind360": "306",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "9",
    "humidity": "79",
    "pop": "32",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "40",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T15:00+08:00",
    "temp": "22",
    "icon": "102",
    "text": "Few Clouds",
    "wind360": "304",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "9",
    "humidity": "77",
    "pop": "38",
    "precip": "0.0",
    "pressure": "820",
    "cloud": "40",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T16:00+08:00",
    "temp": "21",
    "icon": "302",
    "text": "Thundershower",
    "wind360": "300",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "77",
    "pop": "51",
    "precip": "0.3",
    "pressure": "819",
    "cloud": "70",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T17:00+08:00",
    "temp": "21",
    "icon": "302",
    "text": "Thundershower",
    "wind360": "293",
    "windDir": "NW",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "80",
    "pop": "51",
    "precip": "0.7",
    "pressure": "819",
    "cloud": "40",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T18:00+08:00",
    "temp": "21",
    "icon": "102",
    "text": "Few Clouds",
    "wind360": "281",
    "windDir": "W",
    "windScale": "1-3",
    "windSpeed": "7",
    "humidity": "80",
    "pop": "47",
    "precip": "0.0",
    "pressure": "818",
    "cloud": "38",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T19:00+08:00",
    "temp": "20",
    "icon": "153",
    "text": "Partly Cloudy",
    "wind360": "221",
    "windDir": "SW",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "82",
    "pop": "20",
    "precip": "0.0",
    "pressure": "818",
    "cloud": "37",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T20:00+08:00",
    "temp": "20",
    "icon": "153",
    "text": "Partly Cloudy",
    "wind360": "152",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "4",
    "humidity": "83",
    "pop": "20",
    "precip": "0.0",
    "pressure": "818",
    "cloud": "35",
    "dew": "17"
  },
  {
    "fxTime": "2024-05-04T21:00+08:00",
    "temp": "20",
    "icon": "150",
    "text": "Clear",
    "wind360": "143",
    "windDir": "SE",
    "windScale": "1-3",
    "windSpeed": "6",
    "humidity": "83",
    "pop": "20",
    "precip": "0.0",
    "pressure": "818",
    "cloud": "27",
    "dew": "17"
  }
]

export async function GET(request){
  if (useStoredData()) {return Response.json(cached);}

  let url = "";
  try {
    url = moveSearchParams(request.url, baseUrl);
    const data = await doFetchBack(url);
    await console.log(data);
    return Response.json(data.hourly);
  }
  catch (e){
    return handleErrBack(request.url, url, e);
  }
}


